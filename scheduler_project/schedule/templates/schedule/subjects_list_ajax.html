{% extends 'schedule/base.html' %}
{% load static %}
{% load auth_extras %}
{% block content %}

<head>
    <meta charset="UTF-8">
    <title>Lista tematów</title>


</head>


<body>
<br>
<h2 style="text-align:center;">LISTA TEMATÓW</h2>

<br>

{% for message in messages %}
    <errormsg style="text-align:center;">{{ message }}</errormsg><br><br>
{% endfor %}

<div class="container" style="max-width:1000px;">


{% for i in all_subjects_list %}
<div class="card">
    <h4 class="card-header">{{i.title}}
    {% if request.user|has_group:"admin" %}
    &nbsp;
    <a href="{% url 'subject_edit' i.id %}"><img src="{% static 'images/icons/edit.png' %}" style="text-align:right; width:25px; height:25px;"></a>
    &nbsp;
    <a href="{% url 'delete_subject' i.id %}" onclick="return confirm('Czy na pewno chcesz usunąć temat {{i.title}}? Operacji nie będzie można cofnąć!');"><img src="{% static 'images/icons/delete.png' %}" style="text-align:right; width:25px; height:25px;"></a>
    {% endif %}
    </h4>

    <br>
        <h5 class="card-text" id="description">Opis: {{ i.description }}</h5>

    <div class="container" style="max-width:500px;">
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-6">

        <span class="count">
            <span class="total">{{ i.like_count }}</span>
        </span>
            <p>{{ request.user }}</p>
            <p>{{ i.likes.all }}</p>
            <p>ID {{ i.id }}</p>
        <a href="#" data-id="{{ i.id }}" data-action="{% if request.user in i.likes.all %}un{% endif %}like"
           class="like button">
        {% if request.user not in i.likes.all %}
            Podoba mi się
        {% else %}
            Nie podoba mi się
        {% endif %}
        </a>


        <span class="lead_count">
            <span class="lead_total">{{ i.lead_count }}</span>
        </span>
            <p>{{ request.user }}</p>
            <p>{{ i.want_to_lead.all }}</p>
            <p>ID {{ i.id }}</p>
        <a href="#" data-id="{{ i.id }}" data-action="{% if request.user in i.want_to_lead.all %}un{% endif %}like"
           class="lead button">
        {% if request.user not in i.want_to_lead.all %}
            Chcę poprowadzić
        {% else %}
            Nie chcę prowadzić
        {% endif %}
        </a>


        </div>

      </div>
    </div>

        <br>


{% endfor %}
    <script src="{% static 'js/select2.min.js' %}"></script>
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/jquery.datatables.min.js' %}"></script>
    <script src="{% static 'js/datatables.bootstrap4.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2.2.1/src/js.cookie.min.js"></script>
<script>
$(document).ready(function () {
            $('#dataTable').DataTable();
        });
</script>

  <script>
    var csrftoken = Cookies.get('csrftoken');
    function csrfSafeMethod(method) {
      // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
      beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
          xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
      }
    });

    $(document).ready(function(){
        $('a.like').click(function(e){
    e.preventDefault();
    $.post('{% url "ajax_like" %}',
      {
        id: $(this).data('id'),
        action: $(this).data('action')
      },
      function(data){
        if (data['status'] == 'ok')
        {
          var previous_action = $('a.like').data('action');

          // toggle data-action
          $('a.like').data('action', previous_action == 'like' ?
          'unlike' : 'like');
          // toggle link text
          $('a.like').text(previous_action == 'like' ? 'Nie podoba mi się' :
          'Podoba mi się');

          // update total likes
          var previous_likes = parseInt($('span.count .total').text());
          $('span.count .total').text(previous_action == 'like' ?
          previous_likes + 1 : previous_likes - 1);
        }
      }
    );
  });

  $('a.lead').click(function(e){
    e.preventDefault();
    $.post('{% url "ajax_lead" %}',
      {
        id: $(this).data('id'),
        action: $(this).data('action')
      },
      function(data){
        if (data['status'] == 'ok')
        {
          var previous_action = $('a.lead').data('action');

          // toggle data-action
          $('a.lead').data('action', previous_action == 'like' ?
          'unlike' : 'like');
          // toggle link text
          $('a.lead').text(previous_action == 'like' ? 'Chcę poprowadzić' :
          'Nie chcę prowadzić');

          // update total likes
          var previous_likes = parseInt($('span.lead_count .lead_total').text());
          $('span.lead_count .lead_total').text(previous_action == 'like' ?
          previous_likes + 1 : previous_likes - 1);
        }
      }
    );
  });

    });
  </script>
{% endblock %}

</body>
